<?xml version="1.0" encoding="iso-2022-jp"?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="content-type" content="text/html;charset=iso-2022-jp" />
<meta http-equiv="content-style-type" content="text/css" />
<title>How to configure a virtual domain</title>
<link rev="made" href="mailto:taki@cyber.email.ne.jp" />
<link rel="stylesheet" href="vida.css" />
<body>
<h1>バーチャルドメイン</h1>
<h2>バーチャルドメイン</h2>
<p>バーチャルドメインの機能はqmailパッケージで提供されているものをそのまま利用しています。qmail-vidaではこのバーチャルドメインを管理するためのいくつかのプログラムを提供します。</p>


<h2>サーバの設定方法</h2>
<p>qmailでバーチャルドメインを利用するためには次の作業を行います。</p>

<h3>バーチャルドメイン用のアカウントの追加</h3>
<p>バーチャルドメインを所有するユーザのアカウントをシステムに追加します。</p>

<h3>control/virtualdomainsの設定</h3>
<p>qmailのcontrol/virtualdomainsファイルにバーチャルドメインの設定を次の形式で追加します。</p>
<pre class="example">
VIRTUALDOMAIN:DOMAINOWNER
</pre>
<p>ここで、VIRTUALDOMAINにはバーチャルドメインのFQDNを記述します。DOMAINOWNERはバーチャルドメインの所有ユーザ名を記述します。例えば、バーチャルドメインvirtual.example.orgの所有ユーザがfooである場合は次のように記述します。</p>
<pre class="example">
virtual.example.org:foo
</pre>

<h3>control/rcpthostsの設定</h3>
<p>qmailのcontrol/rcpthostsファイルにバーチャルドメインのFQDNを追加します。</p>
<p>なお、control/localsにはバーチャルドメインのFQDNを追加してはいけません。</p>

<h3>起動ファイルの設定</h3>
<p>qmail-smtpdおよびqmail-pop3dの起動ファイルで環境変数DOMAINOWNERの設定を行ないます。IPアドレスベースのバーチャルドメインの場合はDOMAINOWNERにドメインの所有ユーザ名を設定するようにします。ログインIDベースのバーチャルドメインの場合にはDOMAINOWNERに空の値を設定します。その後、認証プログラムcheckpasswordがドメイン毎のユーザの処理を行います。</p>

<h3>パスワードデータベースの作成</h3>
<p>パスワードデータベースを作成します。rootの権限で所有者アカウント名を引数としてvida-pwdbinitを実行してください。所有者がvpopであるドメインのパスワードデータベースを作成する場合の例を次に示します。</p>
<pre class="example">
# vida-pwdbinit vpop
</pre>

<h3>MXレコードの追加</h3>
<p>バーチャルドメイン宛のメールが外部から配送されるようにDNSサーバのMXレコードを設定してください。</p>

<p>以上でバーチャルドメインを利用するために必要な設定が終わりました。後で、そのドメインに所属する仮想ユーザを追加してください。</p>

<h2>クライアントの設定方法</h2>
<h3>IPアドレスベースのバーチャルドメイン</h3>
<p>通常の実在ドメインと同じ設定をしてください。</p>

<h3>ログインIDベースのバーチャルドメイン</h3>
<p>ログインIDにはユーザ名の後ろに'@'か'%'を付け、さらにその後ろにバーチャルドメインのFQDNか所有者アカウント名を付けてください。例えば、ユーザ名が'foo'で、バーチャルドメインのFQDNが'example.org'で、その所有者アカウント名が'vpop'の場合にはログインIDは'foo@example.org', 'foo%example.org'あるいは'foo@vpop', 'foo@vpop'になります。'@'と'%'以外のデリミタを利用したい場合には起動ファイルにて環境変数 DOMAINDELIMITERS に利用したい文字を設定するようにしてください。</p>

</body>
</html>
