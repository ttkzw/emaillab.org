<html>
<body>
<a href="../djb.html">D. J. Bernstein</a>
<br><a href="../unix.html">UNIX</a>
<br><a href="../daemontools.html">daemontools</a>
<h1>The setlock program</h1>
<tt>setlock</tt> runs another program with a file locked.
<h2>Interface</h2>
<pre>
     setlock <i>opts</i> <i>fn</i> <i>child</i>
</pre>
<p>
<tt><i>opts</i></tt> is a series of getopt-style options.
<tt><i>fn</i></tt> is a single argument.
<tt><i>child</i></tt>
consists of one or more arguments.
<p>
<tt>setlock</tt>
opens <tt><i>fn</i></tt> for writing
(creating it if it does not exist),
obtains an exclusive lock on it,
and runs <tt><i>child</i></tt>.
<p>
Normally the lock disappears when <tt><i>child</i></tt> exits.
<p>
Here's the complete story:
<tt><i>child</i></tt> is given a descriptor
for a locked ofile pointing to the disk file named <tt><i>fn</i></tt>.
The lock disappears when this ofile is
<ul>
<li>closed by all the processes that have descriptors for it or
<li>explicitly unlocked.
</ul>
<h2>Options</h2>
<ul>
<li><tt>-n</tt>:
No delay.
If <tt><i>fn</i></tt> is locked by another process,
<tt>setlock</tt> gives up.
<li><tt>-N</tt>:
(Default.)
Delay.
If <tt><i>fn</i></tt> is locked by another process,
<tt>setlock</tt> waits until it can obtain a new lock.
<li><tt>-x</tt>:
If <tt><i>fn</i></tt> cannot be opened (or created) or locked,
<tt>setlock</tt> exits zero.
<li><tt>-X</tt>:
(Default.)
If <tt><i>fn</i></tt> cannot be opened (or created) or locked,
<tt>setlock</tt> prints an error message and exits nonzero.
</ul>
</body>
</html>
