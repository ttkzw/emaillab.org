<html>
<body>
<a href="../djb.html">D. J. Bernstein</a>
<br><a href="../unix.html">UNIX</a>
<br><a href="../daemontools.html">daemontools</a>
<h1>The svscan program</h1>
<tt>svscan</tt>
starts and monitors a collection of services.
<h2>Interface</h2>
<tt>svscan</tt>
starts one
<a href="supervise.html">supervise</a>
process for each subdirectory of the current directory,
up to a limit of 1000 subdirectories.
<tt>svscan</tt> skips subdirectory names starting with dots.
<tt>supervise</tt>
must be in <tt>svscan</tt>'s path.
<p>
If a subdirectory <tt><i>sub</i></tt> is sticky,
<tt>svscan</tt>
starts a pair of <tt>supervise</tt> processes,
one for <tt><i>sub</i></tt>,
one for <tt><i>sub</i>/log</tt>,
with a pipe between them.
<tt>svscan</tt>
needs two free descriptors for each pipe.
<p>
Every five seconds,
<tt>svscan</tt>
checks for subdirectories again.
If it sees a new subdirectory,
it starts a new <tt>supervise</tt> process.
If it sees an old subdirectory where a <tt>supervise</tt> process has exited,
it restarts the <tt>supervise</tt> process.
In the sticky case it reuses the same pipe
so that no data is lost.
<p>
<tt>svscan</tt>
is designed to run forever.
If it has trouble creating a pipe or running <tt>supervise</tt>,
it prints a message to stderr;
it will try again five seconds later.
<p>
If <tt>svscan</tt> is given a command-line argument,
it switches to that directory when it starts.
<h2><a name="boot"></a>The <tt>/service</tt> directory</h2>
Normally <tt>svscan</tt> is started at boot time
in a new <tt>/service</tt> directory.
To set this up (under version 0.70 or above),
first create <tt>/service</tt> as root:
<pre>
     mkdir /service
     chmod 755 /service
</pre>
Then start <tt>svscan</tt> from your system's boot scripts:
<ul>
<li>On Linux and other SVR4-based systems with <tt>/etc/inittab</tt>,
add <tt>SV:123456:respawn:env - PATH=/usr/local/bin:/usr/sbin:/usr/bin:/bin svscan /service &lt;/dev/null &gt;/dev/console 2&gt;/dev/console</tt>
to the end of <tt>/etc/inittab</tt>,
and type <tt>kill -HUP 1</tt>.
<li>On BSD systems,
put <tt>env - PATH=/usr/local/bin:/usr/sbin:/usr/bin:/bin csh -cf 'svscan /service &amp;'</tt>
into <tt>/etc/rc.local</tt>,
and reboot.
</ul>
Now use <tt>ps</tt> to check that <tt>svscan</tt> is running.
<p>
To install a new service,
make a symbolic link from <tt>/service/<i>sub</i></tt>
to a directory elsewhere in the filesystem.
<tt>svscan</tt> will spot the link within five seconds
and will start a <tt>supervise</tt> process,
or two <tt>supervise</tt> processes if <tt><i>sub</i></tt> is sticky.
You can then use
<a href="svc.html">svc</a> on <tt>/service/<i>sub</i></tt>
to control the service.
<p>
To eliminate a service,
remove the symbolic link, and then stop the <tt>supervise</tt> processes:
<pre>
     cd /service/<i>sub</i>
     rm /service/<i>sub</i>
     svc -dx . log
</pre>
<h2>Other service-monitoring tools</h2>
SVR4-based <tt>init</tt> programs
run daemons listed in <tt>/etc/inittab</tt>.
<p>
Sun's <tt>sac</tt> program
runs ``port monitors'' listed in <tt>/etc/saf/_sactab</tt>.
</body>
</html>
