<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<title>The rblsmtpd program</title>
</head>
<body>
<a href="http://cr.yp.to/djb.html">D. J. Bernstein</a>
<br><a href="http://cr.yp.to/tcpip.html">TCP/IP</a>
<br><a href="top.html">ucspi-tcp</a>
<h1><a href="http://cr.yp.to/ucspi-tcp/rblsmtpd.html"><tt>rblsmtpd</tt> プログラム</a></h1>
<tt>rblsmtpd</tt> は RBL に登録されているサイトからのメイルを拒否します。
<a href="tcpserver.html"><tt>tcpserver</tt></a> の下で動いている SMTP サーバで動かせます。

<h2>使い方</h2>
<pre>
     rblsmtpd <i>opts</i> <i>prog</i>
</pre>
<tt><i>opts</i></tt> は <tt>getopt</tt> 形式のオプション郡です。
<tt><i>prog</i></tt> は一つ以上の引数から成ります。

<p>
通常、<tt>rblsmtpd</tt> は <tt><i>prog</i></tt> を起動します。
<tt><i>prog</i></tt> はメイルを受け取るために SMTP 交信を受け持ちます。

<p>
ただし、クライアントからのメイルを拒否するように指定されていれば、<tt>rblsmtpd</tt> は <tt><i>prog</i></tt> を呼び出しません。
代わりに、メッセージの送信の試みを一時的に全て拒否する内蔵の限定された SMTP 交信を行います。一方、記述子 2 にその動作記録を一行書き出します。

<p>
クライアントからの接続断が無い場合でも、<tt>rblsmtpd</tt> は60秒後に限定された SMTP 交信を打ち切ります。

<p>
オプション:
<ul>
<li><tt>-t <i>n</i></tt>:
タイムアウトを <tt><i>n</i></tt> 秒に変えます。
</ul>

<h2>拒否されるクライアント</h2>
環境変数 <tt>$RBLSMTPD</tt> が設定されていてかつ空でないとき、
<tt>rblsmtpd</tt> はメイルを拒否します。
<tt>$RBLSMTPD</tt> をクライアントに対するエラーメッセージとして使います。
通常、<tt>rblsmtpd</tt> は <a href="tcpserver.html"><tt>tcpserver</tt></a> の下で動きます。
<a href="tcprules.html"><tt>tcprules</tt></a> を使って、選択したクライアントに <tt>$RBLSMTPD</tt> を設定することができます。

<p>
<tt>$RBLSMTPD</tt> が空に設定されているとき、<tt>rblsmtpd</tt> はメイルを拒否しません。

<P>
<tt>$RBLSMTPD</tt> が設定されていないとき、<tt>rblsmtpd</tt> は RBL で <tt>$TCPREMOTEIP</tt> を検索し、<tt>$TCPREMOTEIP</tt> が登録されていれば、メイルを拒否します。
<tt>tcpserver</tt> はリモートホストの IP アドレスとして <tt>$TCPREMOTEIP</tt> を設定します。

<p>
オプション:
<ul>
<li><tt>-r <i>base</i></tt>:
RBL のソースとして <tt><i>base</i></tt> を使います。
<tt><i>d</i>.<i>c</i>.<i>b</i>.<i>a</i>.<i>base</i></tt> が TXT レコードを持っていれば、IP アドレス <tt><i>a</i>.<i>b</i>.<i>c</i>.<i>d</i></tt> はそのソースに登録されています。
<tt>rblsmtpd</tt> はクライアントへのエラーメッセージとして TXT レコードの内容を使います。
<li><tt>-a <i>base</i></tt>:
anti-RBL のソースとして <tt><i>base</i></tt> を使います。
<tt><i>d</i>.<i>c</i>.<i>b</i>.<i>a</i>.<i>base</i></tt> が A レコードを持っていれば、IP アドレス <tt><i>a</i>.<i>b</i>.<i>c</i>.<i>d</i></tt> はそのソースに登録されて(anti-listed)います。
この場合、<tt>rblsmtpd</tt> はメイルを拒否しません。
</ul>

<p>
いくつでも <tt>-r</tt> と <tt>-a</tt> オプションを付けることができます。
<tt>rblsmtpd</tt> は <tt>$TCPREMOTEIP</tt> を登録しているソースが見つかるまで各ソースを順番に試します。
<tt>-r</tt> オプションを付けなければ、<tt>rbl.maps.vix.com</tt> という RBL ソースを試します。

<h2>RBL sources</h2>
<tt>rblsmtpd</tt> 用に自分で RBL ソースや anti-RBL ソースを動かしたいのであれば、djbdns パッケージの <a href="http://djbdns.jp.qmail.org/djbdns/rbldns.html">rbldns</a> を使うことができます。

<p>
以下のような公開 RBL ソースを聞いたことがあります:
<ul>
<li><tt>blackholes.mail-abuse.org</tt> または <tt>rbl.maps.vix.com</tt>
<li><tt>dialups.mail-abuse.org</tt> または <tt>dul.maps.vix.com</tt>
<li><tt>relays.msci.memphis.edu</tt> または <tt>relays.mail-abuse.org</tt> または <tt>rss.maps.vix.com</tt>
<li><tt>relays.orbs.org</tt>
</ul>
<tt>relays.mail-abuse.org</tt> と <tt>rss.maps.vix.com</tt> は2000年8月に <tt>rblsmtpd</tt> で動かすのをやめました。全ての TXT レコードが削除されたためです。
「ゾーンファイルが大きくなっているためそれらが除去された。」とメンテナーは言いました。
<tt>rbldns</tt> データベースがゾーンファイルより遥かに小さいので、この問題は <tt>rbldns</tt> では起こらないでしょう。
しかし、MAPS を動かしている人々は BIND に金銭的利害(financial interests)も持っていて、<tt>rbldns</tt> を使うのを拒否します。

<h2>一時エラー</h2>
通常、<tt>$RBLSMTPD</tt> が設定されていれば、<tt>rblsmtpd</tt> はその限定された SMTP 交信でエラーコード 451 を使います。
これは、まともなクライアントに後で再び接続を試みるように伝えます。
これにより、問題に気づいていない管理者に問題を認識して、中継を禁止し、RBLの登録を取消し、メイルを配送できるようにする機会を与えます。

<p>
だたし、<tt>$RBLSMTPD</tt> がハイフンで始まっていれば、<tt>rblsmtpd</tt> はハイフンを取り除き、エラーコード 553 を使います。
これは、まともなクライアントにすぐにメッセージを送り返すように伝えます。

<p>
RBL 検索においていくつかのエラー処理オプションがあります:
<ul>
<li><tt>-B</tt>:
(デフォルト)
RBL に登録されている IP アドレスに対してエラーコード 451 を使います。

<li><tt>-b</tt>:
RBL に登録されている IP アドレスに対してエラーコード 553 を使います。

<li><tt>-C</tt>:
(デフォルト)
``fail-open'' モードで RBL 検索を扱います。
RBL 検索が一時的に失敗した場合に、そのアドレスが登録されていないと考えます。
anti-RBL 検索が一時的に失敗した場合に、そのアドレスが登録されていると考えます。
不幸なことに、知識のある攻撃者がメイルを拒否しないように RBL 検索や anti-RBL 検索を一時的に失敗させることができます。

<li><tt>-c</tt>:
``fail-closed'' モードで RBL 検索を扱います。
RBL 検索が一時的に失敗した場合に、そのアドレスが登録されていると考えます（しかし、<tt>-b</tt> があっても、エラーコード 451 を使います）。
anti-RBL 検索が一時的に失敗した場合に、そのアドレスが登録されていないと考えます（<tt>-b</tt> オプションが付いて、別の RBL 検索が成功してもエラーコード 451 を使います）。
不幸なことに、これは時々まともなメイルの配送を遅らせます。
</ul>

<hr>
訳：滝澤 隆史(rblsmtpd-0.70 における 前野 年紀 訳を基にしている)<br>
<!-- hhmts start -->
Last modified: Mon Apr 16 20:27:37 2001
<!-- hhmts end -->
</body>
</html>
