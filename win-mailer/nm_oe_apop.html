<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
<title>MUAs for Windows - APOP with Netscape Messanger and Outlook Express</title>
<meta http-equiv="content-type" content="text/html;charset=iso-2022-jp">
<meta http-equiv="content-style-type" content="text/css">
<link rev="made" href="mailto:taki@cyber.email.ne.jp">
<link rel="stylesheet" href="../taki.css">
</head>
<body lang="ja">
<h1>Windows のメイラーの選定</h1>
<h2>Netscape Messanger と Outlook Express は APOP に対応しているのか？</h2>
<p>1998年12月6日初稿、1999年1月17日最終更新</p>
<hr>
<h3>そもそもの疑問</h3>
<p>APOP 対応の確認を POP3 サーバとしては代表的な qpopper を用いて行っています。Netscape Messanger と Outlook Express はこの試験では APOP に対応していないという結果を出しています。これらのメイラーは APOP での認証に失敗していますし、APOP の設定もありません。しかし、雑誌の記事や出版者のウェブサイトの情報(<a href="http://www.watch.impress.co.jp/internet/www/article/980804/mail.htm">インプレスの記事</a>)及び APOP 対応の<a href="http://www.nifty.ne.jp/support/howto/mail/setup.htm">NIFTY SERVE の説明</a>によるとこれらのメイラーは APOP に対応しているという記述があります。メイラーによっては APOP 対応のサーバに対して自動的に(といっても平文での認証に失敗した後に APOP で再度試すものはいくつかのメイラーで確認できています) APOP で認証を行うものもあり、これらはそれに該当するという話です。それにも関わらず、qpopper に接続を行うと、平文による認証を行おう(USER コマンド)として、"-ERR You must use APOP to connect to this server" というエラーメッセージが返ってきます。その次に APOP での認証を行おうとせずに終了してしまいます。本当に対応しているのか疑問です。また、APOP に対応している<a href="http://www.iij4u.or.jp/Guide/apop.html">IIJ4U の「動作確認済メールアプリケーション」</a>にはこれらのメイラーは含まれていません。そこで、実際どういう動作をしているのか確認するためにパケットをモニタリングしてみました。</p>

<hr>
<h3>NIFTY SERVE への接続</h3>
<p>NIFTY SERVE は外部からの接続用に apop.nifty.ne.jp という APOP 用の POP3 サーバを用意しています。ここに、接続をしてみてコマンドの応答を確認してみました。なお、各行頭の "S:" はサーバから送られたメッセージを、"C:" はクライアントが送ったコマンドを示すことにします。</p>
<ul>
<li>Netscape Messanger 4.5 の場合<br>
<pre>
S: +OK NIFTY Corporation Pop server v1.01 &lt;13130.912907545@pop-3.nifty.ne.jp&gt;
C: AUTH
S: -ERR Unknown command: AUTH
C: USER xxxxxxxx
S: +OK Enter password for xxxxxxxx
C: PASS yyyyyyyy
S: +OK xxxxxxxx has 0 message
C: STAT
S: +OK 0 0
C: QUIT
S: +OK Good Bye
</pre>
<li>Outlook Express 4.72.3110.5 の場合<br>
<pre>
S: +OK NIFTY Corporation Pop server v1.01 &lt;13603.912907884@pop-3.nifty.ne.jp&gt;
C: USER xxxxxxxx
S: +OK Enter password for xxxxxxxx
C: PASS yyyyyyyy
S: +OK xxxxxxxx has 0 message
C: STAT
S: +OK 0 0
C: QUIT
S: +OK Good Bye
</pre>
</ul>
<p>Netscape Messanger の方は "AUTH" コマンド(平文パスワードとAPOP以外の認証方法を提供するコマンド) を送り、拒否され、次に平文パスワード(USER/PASS コマンド)による認証を行い、成功しています。Outlook Express は始めから平文パスワードでの認証を行い、成功しています。ちなみに、APOP での認証は "APOP"コマンドを用います。</p>
<p>本題とは離れ、NIFTY SERVE に特化した話になりますが、APOP のみではなく、平文での認証も行っていることが確認できました(1998年12月6日現在)。このことは平文での認証を試みた後に APOP での認証を行うメイラーを使っている場合は、APOP で認証を行っているつもりで安心していたら、実はパスワードが平文のまま流れていたということになりかねません。また、Netscape Messanger と Outlook Express は共に NIFTY SERVE では平文パスワードで認証が行われていることが分かりました。そういうわけで、NIFTY を使用している方は注意しましょう。</p>

<h3>qpopper への接続</h3>
<p>次に qpopper へ接続してみたときのコマンドの応答を見てみます。ここで xxxxxxxx というユーザは APOP 用のアカウントしかありません。なお、各行頭の "S:" はサーバから送られたメッセージを、"C:" はクライアントが送ったコマンドを示すことにします。</p>
<ul>
<li>Netscape Messanger 4.5 の場合<br>
<pre>
S: +OK QPOP (version 2.53) at pop.somewhere.co.jp starting.  &lt;31336.912908644@pop.somewhere.co.jp&gt;
C: AUTH
S: -ERR Too few arguments for the auth command.
C: USER xxxxxxxx
S: -ERR You must use APOP to connect to this server
S: -ERR POP EOF received
S: +OK Pop server at pop.somewhere.co.jp signing off.
</pre>
<li>Outlook Express 4.72.3110.5 の場合<br>
<pre>
S: +OK QPOP (version 2.53) at pop.somewhere.co.jp starting.  &lt;31373.912909127@pop.somewhere.co.jp&gt;
C: USER xxxxxxxx
S: -ERR You must use APOP to connect to this server
S: -ERR POP EOF received
S: +OK Pop server at pop.somewhere.co.jp signing off.
</pre>
<p>サーバの設定において[受信メールサーバー]の項目の「セキュリティで保護されたパスワード認証でログオンする」を選択した場合</p>
<pre>
S: +OK QPOP (version 2.53) at pop.somewhere.co.jp starting.  &lt;31432.912910391@pop.somewhere.co.jp&gt;
C: AUTH 
S: -ERR Too few arguments for the auth command.
S: -ERR POP EOF received
S: +OK Pop server at pop.somewhere.co.jp signing off.
</pre>
</ul>
<p>共に AUTH, USER コマンドで認証を行おうとして、拒否されています。APOP で再度認証を試みようとする動きは見られませんでした。</p>

<h3>結論</h3>
<p>以上の結果より、Netscape Messanger と Outlook Express は APOP に対応していないとしか考えられません。その代わり、APOP 以外のセキュアな認証方法を提供していることは AUTH コマンドから確認できます。恐らく SASL による認証であると思われますが、qpopper 2.53 は AUTH コマンドを実装していないので詳しくは確認できません。AUTH コマンドに関しては RFC 1734, RFC 2449 に記述されているので、知りたい方は<a href="../emailref/emailref.html#pop">「電子メール関連リンク集 - 規格文書(RFCなど)」</a>を参照してください。また、これらは SSL に対応しているので通信路を暗号化した上で認証を行うことができます。この場合は平文パスワードによる認証でも一応（SSL の強度にも因りますが）安全ですが、対応しているサーバが限定されます。（メイルサーバを <a href="http://www.yajima.kuis.kyoto-u.ac.jp/staffs/sengoku/stone/Welcome.ja.html">stone</a> や <a href="http://www.hitachi-ms.co.jp/bjorb/">bjorb</a> と組み合わせて SSL 化できるという情報を頂きました。）</p>

<p>Thanks to MORITA, Koji</p>
<hr>
<p class="footmenu">
<a href="index.html">目次</a> - 
<a href="first.html">はじめに（選定条件など）</a> - 
<a href="selected.html">選定したメイラ─</a> - 
<a href="problem.html">メイラ─の問題点</a> - 
<a href="table.html">一覧表</a> - 
</p>
<hr>
</body>
</html>
